/* http://farski.github.com/jquery-blend/license.txt */
(function(b){function c(e,d){this.algorithm=e;this.precision=d;this.process=function(h,g){var f=this;if(this.precision=="subpixel"){}else{return[this.algorithm(h[0],g[0]),this.algorithm(h[1],g[1]),this.algorithm(h[2],g[2])]}}}var a={normal:new c(function(e,d){return d}),darken:new c(function(e,d){return Math.min(e,d)}),multiply:new c(function(e,d){return((e*d)/255)}),colorburn:new c(function(e,d){return d<=0?0:Math.max(255-((255-e)*255/d),0)}),linearburn:new c(function(e,d){return Math.max(0,(e+d-255))}),lighten:new c(function(e,d){return Math.max(e,d)}),screen:new c(function(e,d){return(255-(((255-e)*(255-d))/255))}),colordodge:new c(function(e,d){return d>=255?255:Math.min(e*255/(255-d),255)}),lineardodge:new c(function(e,d){return Math.min((e+d),255)}),overlay:new c(function(e,d){return(e<128)?((2*e*d)/255):(255-(2*(255-e)*(255-d)/255))}),softlight:new c(function(e,d){return(e<128)?(((d>>1)+64)*e*(2/255)):(255-(191-(d>>1))*(255-e)*(2/255))}),hardlight:new c(function(e,d){return d<128?(2*e*d)/255:255-((2*(255-e)*(255-d))/255)}),difference:new c(function(e,d){return Math.abs(e-d)}),exclusion:new c(function(e,d){return 255-(((255-e)*(255-d)/255)+(e*d/255))}),subtract:new c(function(e,d){return Math.max((e-d),0)})};b.fn.blend=function(d){var e={mode:"normal",adjustment:"rgb(128, 128, 128)",opacity:1};d=b.extend(e,d);return this.each(function(){if("getContext" in document.createElement("canvas")){this.onload=function(){var q=this;var g=document.createElement("canvas");var p=g.getContext("2d");g.width=this.width;g.height=this.height;p.drawImage(this,0,0);var l=p.getImageData(0,0,g.width,g.height);var m=l.data;var h=a[d.mode];if(d.adjustment.match(/^rgb/)){var o=d.adjustment.match(/rgb\(([0-9]+), ?([0-9]+), ?([0-9]+)/);var k=[parseFloat(o[1],10),parseFloat(o[2],10),parseFloat(o[3],10)];for(var j=0;j<m.length;j+=4){var f=[m[j],m[j+1],m[j+2]];var r=h.process(f,k);m[j+0]=r[0];m[j+1]=r[1];m[j+2]=r[2]}p.putImageData(l,0,0);b(q).replaceWith(g)}else{var n=new Image;n.src=d.adjustment;n.onload=function(){var v=document.createElement("canvas");var t=v.getContext("2d");v.width=q.width;v.height=q.height;t.drawImage(n,0,0);var y=t.getImageData(0,0,v.width,v.height);var z=y.data;for(var w=0;w<m.length;w+=4){var u=[m[w],m[w+1],m[w+2]];var x=[z[w],z[w+1],z[w+2]];var s=h.process(u,x);m[w+0]=s[0];m[w+1]=s[1];m[w+2]=s[2]}p.putImageData(l,0,0);b(q).replaceWith(g)}}}}})}})(jQuery);